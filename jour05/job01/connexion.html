<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Connexion</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="header">
      <div class="logo"><span class="logo-mark">J5</span>Jour 05</div>
    </header>
    <div class="container">
      <h2>Connexion</h2>
      <form id="connexionForm" autocomplete="off" novalidate>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" required />
          <div class="error" id="error-email"></div>
        </div>
        <div class="form-group">
          <label for="password">Mot de passe</label>
          <input
            type="password"
            id="password"
            name="password"
            required
            minlength="8"
          />
          <div class="error" id="error-password"></div>
        </div>
        <button type="submit" id="submitBtn" class="submit-btn" disabled>
          Connexion
        </button>
      </form>
      <button onclick="window.location.href='index.php'" class="retour-btn">
        Retour à l'accueil
      </button>
    </div>
    <script>
      // Validation rules
      const validators = {
        email: (value) =>
          /^[\w-.]+@([\w-]+\.)+[\w-]{2,}$/.test(value)
            ? ""
            : "L'email n'est pas valide.",
        password: (value) => {
          if (value.length < 8)
            return "Le mot de passe doit contenir au moins 8 caractères.";
          if (!/[a-z]/.test(value))
            return "Le mot de passe doit contenir au moins une minuscule.";
          if (!/[A-Z]/.test(value))
            return "Le mot de passe doit contenir au moins une majuscule.";
          if (!/[0-9]/.test(value))
            return "Le mot de passe doit contenir au moins un chiffre.";
          if (!/[@$!%*?&]/.test(value))
            return "Le mot de passe doit contenir au moins un caractère spécial (@$!%*?&).";
          if (/\s/.test(value))
            return "Le mot de passe ne doit pas contenir d'espace.";
          return "";
        },
      };

      const form = document.getElementById("connexionForm");
      const submitBtn = document.getElementById("submitBtn");
      const fields = ["email", "password"];

      // Asynchronous validation simulation
      function asyncValidate(field, value) {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve(validators[field](value));
          }, 200); // Simule une requête asynchrone
        });
      }

      async function validateField(field) {
        const input = document.getElementById(field);
        const errorDiv = document.getElementById("error-" + field);
        const errorMsg = await asyncValidate(field, input.value);
        errorDiv.textContent = errorMsg;
        return !errorMsg;
      }

      async function validateForm() {
        let valid = true;
        for (const field of fields) {
          const isValid = await validateField(field);
          if (!isValid) valid = false;
        }
        submitBtn.disabled = !valid;
        return valid;
      }

      // Validate on input
      fields.forEach((field) => {
        document.getElementById(field).addEventListener("input", () => {
          validateField(field);
          validateForm();
        });
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const isValid = await validateForm();
        if (isValid) {
          alert("Connexion réussie !");
          form.reset();
          fields.forEach(
            (f) => (document.getElementById("error-" + f).textContent = "")
          );
          submitBtn.disabled = true;
        }
      });
    </script>
  </body>
</html>
